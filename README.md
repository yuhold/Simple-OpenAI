# 🤖 Simple-OpenAI for Yunzai-Bot

<div align="center">

**一个轻量、功能丰富且易于配置的 OpenAI / Gemini 对话插件**

![Yunzai-Bot](https://img.shields.io/badge/Yunzai-Bot-v3-red?style=flat-square)
![Nodejs](https://img.shields.io/badge/Node.js-16+-green?style=flat-square)
![License](https://img.shields.io/badge/license-MIT-blue?style=flat-square)

</div>

## ✨ 简介

Simple-OpenAI 是一个专为 Yunzai-Bot 设计的对话插件。它旨在提供简单、稳定且高度可定制的 AI 对话体验。支持 OpenAI 格式的接口（包括 ChatGPT, Gemini, Claude 等中转服务），并内置了完善的权限管理和防刷机制。

## 🚀 核心特性

- **多模型支持**：支持 GPT-3.5/4, Gemini Pro/Flash, Claude 等，支持自定义模型名称。
- **上下文记忆**：支持多轮对话，可配置记忆轮数。
- **配置便捷**：完美适配 **锅巴插件 (Guoba-Plugin)**，全UI配置，无需修改代码。
- **网络优化**：支持 HTTP 代理（Clash等），支持自定义 API 地址（中转/反代）。
- **权限管理**：
  - 群组开关：群管理员可独立控制本群 AI。
  - 私聊控制：支持全局私聊开关、免前缀模式。
  - 黑白名单：支持私聊黑名单和白名单模式切换。
- **安全与稳定**：
  - **顺序处理**：支持消息排队，防止并发请求导致报错或逻辑混乱。
  - **速率限制**：可配置单位时间内的访问次数，防止恶意刷额度。
  - **违禁词过滤**：自动拦截包含敏感词的提问。
- **体验优化**：
  - **Markdown 清洗**：自动去除 AI 回复中的 `**加粗**`、`#` 等符号，使气泡显示更干净。
  - **长消息转发**：回复内容过长时自动转为合并转发消息。

## 📥 安装教程

### 1. 克隆插件
在 Yunzai-Bot 根目录打开终端（命令行），运行：

```bash
cd plugins
git clone [https://github.com/yuhold/Simple-OpenAI.git](https://github.com/yuhold/Simple-OpenAI.git)

```

### 2. 安装依赖 (⚠️ 重要)

**必须安装依赖库**，否则插件无法运行（会报 `fetch failed` 或找不到模块）：

```bash
cd Simple-OpenAI
pnpm install

```

### 3. 重启机器人

```bash
node app

```

## ⚙️ 配置说明 (推荐)

本插件深度适配 **锅巴插件**，安装后请直接使用锅巴进行配置：

1. 发送 `#锅巴登录` 获取配置地址。
2. 在网页中找到 **“简易OpenAI”** 插件。
3. 填写 **API Key** 和 **API 地址**（必填）。
4. 根据需要开启代理、调整模型、设置权限等。

> **关于 Gemini**：请使用支持 OpenAI 格式转换的中转地址（BaseURL），直接填 Google 官方地址可能无法工作。

## 💬 指令列表

默认触发前缀为 `#chat`（可在锅巴中修改）。

### 基础指令 (所有人)

| 指令 | 说明 |
| --- | --- |
| `#chat [内容]` | 发送内容与 AI 对话 |
| `[内容]` | **(仅限私聊且开启免前缀模式)** 直接对话 |
| `#重置对话` | 清空当前上下文记忆，开启新话题 |
| `#chat帮助` | 查看插件帮助菜单 |

### 群组管理 (群主/管理员)

| 指令 | 说明 |
| --- | --- |
| `#开启本群AI` | 允许机器人在本群响应 AI 对话 |
| `#关闭本群AI` | 禁止机器人在本群响应 AI 对话 |

### 系统管理 (仅机器人主人)

| 指令 | 说明 |
| --- | --- |
| `#开启私聊AI` | 允许全局私聊使用 AI |
| `#关闭私聊AI` | 禁止全局私聊使用 AI |
| `#拉黑私聊 [QQ]` | 将指定用户加入私聊黑名单 |
| `#解禁私聊 [QQ]` | 将指定用户移出私聊黑名单 |
| `#开启白名单模式` | 切换为白名单模式（只回复名单内的人） |
| `#关闭白名单模式` | 切换为黑名单模式（默认，回复除黑名单外的人） |
| `#加白私聊 [QQ]` | 将指定用户加入白名单 |
| `#移除白私聊 [QQ]` | 将指定用户移出白名单 |

## 🛠️ 常见问题 (FAQ)

**Q: 发送消息后没有任何反应？**
A:

1. 请检查 **“允许私聊使用AI”** 开关是否开启。
2. 如果是私聊，请检查是否需要加 `#chat` 前缀（除非开启了免前缀模式）。
3. 检查是否在黑名单中。
4. 检查是否开启了白名单模式且自己不在名单内。

**Q: 报错 `fetch failed` 或 `ConnectTimeoutError`？**
A:
这是网络问题。

1. 如果使用官方 API，请在锅巴里填写 **HTTP代理地址** (如 `http://127.0.0.1:7890`)。
2. 如果使用国内中转，请开启 **“使用自定义API地址”** 并检查地址是否正确。
3. 确保你执行了 `pnpm install` 安装了 `https-proxy-agent`。

**Q: AI 回复乱码或带有很多符号？**
A: 请在锅巴配置中开启 **“去除Markdown格式”** 开关。

## 📝 更新日志

* **v1.3.0**: 新增顺序回复队列、速率限制、白名单模式、Markdown清洗功能。
* **v1.2.0**: 增加私聊黑名单、群组开关、违禁词过滤。
* **v1.1.0**: 支持自定义模型名称、长消息合并转发。
* **v1.0.0**: 基础对话功能发布。

## 📄 免责声明

本插件仅供学习和交流使用。请勿用于生成违法违规内容。使用者需自行承担因使用本插件产生的一切法律责任。